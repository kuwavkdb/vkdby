<div class="bg-white dark:bg-slate-800 p-5 border-b border-slate-100 dark:border-slate-700 last:border-0 hover:bg-slate-50 dark:hover:bg-slate-900/40 transition-colors">
  <div>
    <div class="flex items-center justify-between gap-3 md:gap-4 mb-2 flex-wrap sm:flex-nowrap">
      <div class="flex items-center gap-3 md:gap-4 flex-1">
        <span class="text-xs font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest min-w-[4rem]" title="<%= (@member.part_alias.present? || @member.support?) ? @member.part.upcase : '' %>">
          <%= (@member.support? ? "サポート " : "") + (@member.part_alias.presence || @member.part.upcase) %>
        </span>
        <h3 class="text-base md:text-lg font-black text-slate-800 dark:text-slate-100">

          <% if @member.person && @member.person.key.present? %>
            <%= link_to @member.name, profile_path(@member.person.key), class: "hover:text-person transition-colors" %>
          <% else %>

            <%= @member.name %>
          <% end %>
        </h3>
      </div>
      <div class="flex items-center gap-2">
        <% if @member.sns.present? && @member.sns.is_a?(Array) %>
          <% @member.sns.each do |sns_account| %>
            <% 
              is_x_account = sns_account.start_with?('@')
              sns_url = is_x_account ? "https://x.com/#{sns_account.delete_prefix('@')}" : sns_account
              icon_title = is_x_account ? "X (Twitter)" : "Link"
            %>
            <%= link_to sns_url, target: "_blank", rel: "noopener noreferrer", class: "inline-flex items-center text-slate-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors", title: icon_title do %>
              <% if is_x_account %>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              <% else %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                </svg>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <% if show_status? %>
          <span class="<%= status_classes %>">
            <%= @member.status %>
          </span>
        <% end %>
      </div>
    </div>
    <% if @member.person && @member.person.person_logs.present? %>
      <div class="mt-3 pl-4 border-l-2 border-slate-100 dark:border-slate-800 flex flex-col gap-1">
        <% sorted_person_logs.each do |log| %>
          <div class="flex items-start gap-3 text-[0.7rem] leading-relaxed text-slate-500 dark:text-slate-400">
            <span class="font-black opacity-60 tabular-nums shrink-0"><%= log.log_date %></span>
            <span class="truncate">
              <% if log.unit %>
                <%= link_to log.unit.name, profile_path(log.unit.key), class: "font-bold text-slate-600 dark:text-slate-300 hover:text-person" %>
              <% else %>
                <span class="font-bold"><%= log.unit_name %></span>
              <% end %>
              <% if log.name.present? %>
                <span class="text-xs font-bold text-slate-500 dark:text-slate-400 opacity-80">(<%= log.name %>)</span>
              <% end %>
              <% if log.phenomenon.present? && log.phenomenon != "stay" %>
                <small class="text-[0.65rem] opacity-70 ml-1">(<%= log.try(:phenomenon_text) || log.phenomenon %>)</small>
              <% end %>
            </span>
          </div>
        <% end %>
      </div>
    <% elsif @member.person_id.nil? && @member.inline_history.present? %>
      <div class="mt-3 pl-4 border-l-2 border-slate-100 dark:border-slate-800 flex flex-col gap-1">
        <% @member.inline_history.lines.reject { |line| line.strip.start_with?('//') }.join.split('→').map(&:strip).reject(&:empty?).each do |history_item| %>
          <div class="text-[0.7rem] leading-relaxed text-slate-500 dark:text-slate-400">
            <span class="font-bold text-slate-600 dark:text-slate-300"><%= parse_wiki_links(history_item).html_safe %></span>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
